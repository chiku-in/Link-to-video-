# âœ… List of required channels to join
REQUIRED_CHANNELS = ["@ckdau", "@teravido"]

# âœ… Function to check if user has joined ALL channels
async def is_user_joined_all(update: Update, context: ContextTypes.DEFAULT_TYPE) -> bool:
    user_id = update.effective_user.id
    for channel in REQUIRED_CHANNELS:
        try:
            member = await context.bot.get_chat_member(chat_id=channel, user_id=user_id)
            if member.status not in ["member", "creator", "administrator"]:
                return False
        except:
            return False
    return True

# âœ… /start command handler
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_joined = await is_user_joined_all(update, context)
    if not user_joined:
        buttons = [
            [InlineKeyboardButton(f"ğŸ“¢ Join {channel}", url=f"https://t.me/{channel.strip('@')}")]
            for channel in REQUIRED_CHANNELS
        ]
        buttons.append([InlineKeyboardButton("âœ… I Have Joined", callback_data="check_joined")])
        await update.message.reply_text(
            "ğŸ”’ Please join all the channels below and then tap the button below to continue.",
            reply_markup=InlineKeyboardMarkup(buttons)
        )
        return

    await update.message.reply_text("âœ… Thank you! Now you can send your Terabox link here.")

# âœ… Callback handler for "I Have Joined" button
async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    if query.data == "check_joined":
        user_joined = await is_user_joined_all(update, context)
        if user_joined:
            await query.edit_message_text("âœ… You have successfully joined all channels. You may now send the Terabox link.")
        else:
            await query.edit_message_text("âŒ You have not joined all required channels. Please join them and try again.")
